___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "User.com | Userengage Methods",
  "categories": ["LEAD_GENERATION", "CHAT", "MARKETING"],
  "brand": {
    "id": "user_com",
    "displayName": "User.com",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMoAAADKCAYAAADkZd+oAAAACXBIWXMAAAsSAAALEgHS3X78AAAUmElEQVR4nO2dfXAc5X3HH93u7e7pXbaQjYVtUUz9VhuPS23aMlMT0sEhQ8btNE2ZZIyBf66EGoaUtKR/lH/atJAw4BJ6/9jYKZ2Eaad1yWCcaRLcGUrADR5jagGxU78I2Ua2Zb3f7d6t1Pme7jEn7d3p3nf39vuZ0Qhpz0i3ej77+z2/57fPNs3MzAhSP2Kx2CYhRGfmB+LzpuwfPm4anVOW1sk/iXdY0ja2Xw36Sag2GRH6zJR6RyIZ3hQKzfSFFXupoSY78KMmLT0xnjBSqWmlFV8PXFvUSG+/4VjeNYy3dJaiVEAsFtuGiDAaj2wPK/aGZs1aBhGuTbUYEMBMqeLyRHv6B2QJYfjvnQaZ0+KmzmFBUUoAYoybxg4hxPY2PbF6wtSt88Pd2tBEW1qIjAwUoQGhKAWIxWJ9iWT4fstWd7Qb8S1XJ1utc8OLtU9GFonZiBHW8v9r0khQlHlAjpF480Oakno4rCg9g6Nd6unLS9JijCUiFCOgUJSsyDE90/RoWFGWXBjpUk5f6REQhBARdFFisdiOsUTkqXZDbBkc7RInL/ZSDpKTwIkSi8U6x03j6bBi70rZRsuxgZUqBDFTYcdrCZEERhSkVxOmvqdVF/cNjbeLYwN9XMMgRdPwokCQ0Xgk1hER95wf7hZvn1mFSbnjdYQUomFFkYI0a8rd/Zd61WMDK5lekbJpOFEoCKkFDSOKnKS36eKxwZFFTLFIVWkIUb675+VHdDX03Gi8WX/1va0UhFQdX4uCTt1JS39lZqZp9aGTt6lcAyG1wreiPPvC/ueRZp0YXC44DyG1xneiIIpMWdrrZlJfcvD9zdfb2AmpJb4SRUaR9wdXiJ+fWeU4Tkit8IUo6abFVPhNM2ksZxQhbuB5UZ55/sBXm7XQ3v6Ly/Qjp9Y6jhNSDzwtynN79u2LhO2dh07eprCiRdzEk6Jg8XDS0t+KW/qagyc2K1wXIW7jOVFQ1UqkwkfOXe3uePPUGpZ9iSfwlCi4kSo1rbz6zplbNLTBE+IVPCMK2lA0RdnzRv9GzkeI5/CEKJi0a4q984fvbVVY+iVexHVRvvPCy68lkvq9b/RvoCTEs7gqyqwk2r2vHtuicNJOvEzIrd+NkhA/4YoolIT4jbqLQkmIH6mrKJSE+JW6iYISMCUhfqUuomAxMazYO1ECpiTEj9S8PIy2FKy4czGR+JmaRhQ0OKJ3C20plIT4mZpFFLTKowsYDY7s3SJ+p2ai4H4StMqzC5g0AjVJvVDhilvaGtxPQghFyQHucUeFC3cmssJFGoWqpl7YLQUbQeAed96+SxqJqoqCLYWwWwon76TRqJoo2JwO+25xSyHSiFRljoL1kjY98RhW3h0HCWkAqhJRsBcwtjnloiJpVCoWZTbl0pdwL2DSyFSUejHlIkGhooiCh/jg+SRMuUijU3ZEQes8nnSFh/gQQlFygIZHXU0+97NfrlW5+k6CQFmpF56+iweLcmGRBIWSIwraVDCBP9y/wXGMkEal5IgyGo/E8Bx39nKRIFGSKLNNj8rdb3PNhASMkkRBNOm/1KsympCgUbQoMpqwHEyCSNGiyGjCcjAJIkWJgmjSERH3MJqQoFKUKBOmvuf8cDefp0gCy4KiYBW+VRf3sdJFgsyComAVfmi8nesmJNAsuDIfVuxd3JuLBJ2CoqQfZ20rLQPXFjmOERIkCqZeY4nIU8cGVhZ8DSFBIK8EKAm3G2LLyYu9jmOEBI28oiSS4fsHR7tYEiaBRxSao0zPND3KaELILDlFQdoVVuwlvDGLkFlypl7jpvH4wPBi7qxCSIacEUVpmv7y6Ss9ju8TElQcomTSrh6mXYR8hiP1ylS7HN8nJMg4IoplqzsYTQiZi0OUdiO+hS0rhMxljiixWGzb1clWi53ChMxljijjprHj3PBizfEqQgLO/NRr+ycjTLsImc8cUdr0xGrOTwhxcl0UzE8mTN1iEyQhTrIjyqbzw92cnxCSg+uijMYj24cm2pyvIIR8JkpYsTfwyVmE5Oa6KM2atYwTeUJykxYFDy2dtPREzlcQQq5HlL5rUy0GTwchuUmLYqbUO5h2EZKftCiJZHiTmWJnPSH5SIsSCs30seJFSH7SooQVe2neVxBCZkUx1GQH5yiE5Mdx4xYhxEmIayiELAwiSud4wkjxXBGSn3TqlZpWWvO+ghAyG1F4GggpDETZxIoXIYVh1YuQIqAohBQBRSGkCCgKIUUQGjcNVr0IWYBQm54YKfwSQghTL0KKgKIQUgQUhZAigCjHl3cN81wRkoOMG8chCifzhBRmJJ16qSF7ouDLCAko0o10RGkzEtyChZAcZNwYCUWj0eMtmsnN7wjJAdyAI6x6EVIEsxvgpcKjrHwRMhc4ATeEFCVpK5ccryKEXHcjLcr0dNPZG1rHeFYIyQJOwA1xfQO8cPK4rnIjFkKygRNwQ0hRdDX1DucohMwFTsANkdXrdbareZKb4BGSRcaJz1IvrqUQ4kSuoYjs7uEpS7vA9IuQWeACnJBfXxclaSsfsPJFyCxwAU7Ir6+L0hGJH+5pHedpIkQIARfghDwX2S0sx1csumLxJBEiRMaF4/JUXBclGo0eadVNTVeTPE0k0MABuAAn5HmY0xQ5bhofc0JPgg4cgAvZp2F+9/DhmzopCgk2GQcOZ5+EOaK06YmDKxdd5TyFBBo4ABeyz8EcUZCTLW6Z0NqNeNDPFQkoGPtwIHt+InKkXmIsETnKeQoJKhj7cGD+23eIoimpg6tu+JQDhQQSjH04MP+9O0QxwskfrOi6yp57EkhWdl1NwoH5790hSjQaPZu0lSFGFRI0MOYtW7kMB+a/dYcowLLVvau6hxzfJ6SRwZjH2M/1FnPu59UZmdrXopnfOvzhBsVx0CU+/1vNYm2fJtpbQmJsclr85H+mxIdnWcn2G1vXG2LLOkPc1KOKT4ZS4mh/Qrx70hu3Qt3ac8kOK/Y+xwEhRNPMzIzjm+C5PfsGf/Lx+mWnLy9xHKsnEOOVp5eKNSs1x089cGhM/M1+Vuj8AP6OLz3Zk5ZkPpDlkWeH0hdAt0Da9fnVJy88sfuh3ly/Qs7UK32gaebF9TcOOr5fb/JJAh64t1381S4++tsP5JME4Ps47iYY6xjz+X6FvKJg5n9L95Bws0ly1xfb80oigSxIy4h3+bMvd+aVRILjSMvcAGMcYz1XtUuSVxTM/LHw4mZUKVaAv/96d3r+QrzHH25rTYtSDAvJVCswxjHWc1W7JHlFEbPL+d++fcVZz6+ptDWH0rIgDybeARcvP6TGGOMY644DWRQcWdFo9KCq2JN+aGlBiuZ2nks+o/cGNT2/xEXMy2BsY4xjrBf6NRd8F0lb2b95ed6IVFNQAi4FhG5EFuIuiOz/+M2ekiVB9aveYGxjjC/0Yxd8J2164mlMdNzoKP63IxPio3OlrZX8we+1UhYXKVTOLwQuivVeT8GYxtjGGHccnMeCokSj0ZEJU//R79x82nGs1qCu/hffuyLGp0qrr0MWTCJJfSlXksHLKfGXL11xfL/WYExjbGOML/SjioqNrbq5e92Ng66UirH6Xs6i4t890k1Z6ki5kuAi6MZiI8YyxjTGtuNgDooSBWWz0Xjkx5uXn3McqwdIwbAKXyqUpT6UKwnARdCNViSMZYzpQiXhbIqebXVE4tHbV5xJubUAiRNa6uReZGQpto5PSgcl4De/d1NZkvztgeH0RbDeYAxjLGNMF/ujixYF5k1Z2k/diioAeWypk3uRWRnmBL/6YCW93BLwv//XhNj/ujs7k2IMYywXG01EKaKIrKji1j31yGO/9vSlkif3IqsaxkXJ6oD2on/66/IlQZHGDTB2S40molRRZFRxowImqVQWXAEpS/ng3OGC860Hyltxx1qJW5KITKWr1GgiShVFZKIKqgVu7tSCyV+5siCXRk7tVgOen8F8BBcaXHDKAWkzKlxugTGLsVtqNBHliAITx03jhe3rPnAcqyeVyIJ0AWkDJ/nFg1TrP55ZVtakXWQkwd/LzXtOMGYxdkuNJqIcUURmtX5p+4jp9n31lcgiMpN8XCHRl0RyI3u2yk21RGZO8qUnL7h+YxbGbDGr8LkoSxSsZJqp8BOf+/UPXSsXSyqVBf1hrz27jPe05AAXEqSplbS/uzlxl2CMYqxizBazCp+LvLcCF8N397z8vycGl6//+ZlVVX1j5SDz50q6VeVEEy0VQQbzN6w/VRpp/+FfRtIfbvPbN58WG3sHTn5j94O/Ue6vUlH5p0Uzv4ZfwgtP6pKRpZx1FomMLriSBrEyJi82mL9VKgnWvLwgCcYmxijGquNgCVQUUcCzL+x/3kyGH/3+0d/1xI4tlbRTZIOogj+0GyvH9QZS7P7jzrKrWdkgBcYFyys75Ozc8t+2Hk6++ORjux53HCyBikURmR1b3h9cscwLKZgEtf5q/OEbWRhEEFSzqnGehEcqW9kgktzWez7vziqlUJX8olmzvuiVFEyCuQZ6iSoFV1vk65jUosGyEVIyvA9EXZR7qyUJmlbdrmxlI1MujE3HwTKoSkQRHkzBJLhq4hbhapWAkVoguuDDTxvw4f0jeqC6V81yuGyT98omdpJqpVySqokCnn9x75n+i8v6jpxa6zjmJogCiArVLgEj1YAw/3l0ypOVMgjx+1ua0xGk0jlbLtDNjUm7V6KIZNutH4p1N144+/ijD9/sOFgmVRUlFov1paZDHx06eZvu9g6TucCAwa4gtdjwANJAGDe3esUFQe6PVe3IkQ2iCFLbcm57qDVYWLx3/fumGppeU84KfD6qKgp45vkDX42ErQMH3r1TGUtEHMfdBoMHE/1a7iGFgQRZkI5gbQZ77NYi4kAIvB+kl/jvWkSN+WAuguKG16KIyPRyPbD1LTue1B745uMP/LPjBRVQdVHEbBVs35Sl73z12BbFTIUdx70ArrgQpp7b6UAaDDAZcfC5mI4CiIDfExED/w056t12g9/drbsRiwGr71/ZfNRu1szvP7H7oYeq/f+viSgis2p/7mr3+sMfbnAc8woYeNiSlc2R+UEkLPfu0nqyfe0HYuXiKxWtvheiZpfTFs2889duGBp1a0+wYsDVHWnEXV//JN2TRD5D7oyCc+N1STDGMNYw5hwHq0TNIoqYndxvSk0r7x46uVHz4uR+PnILULf2wPUCfltgnZ28n7DUkL01Go0ed7ygStRUFDEry46krfzrD9/bqlyeaHcc9yLVbOnwC5iDyPUhv4BFxT/5zXfx8J8/WmhL1EqpuShidr7yiKak9vhJFpERBiVlLNR5fQ/dckAhAWkVNnnw29PLpCSWre7+xu4HX3K8oMrURRThk0pYISAMKmWNcN8K5JAfXizzLkStK1y5qJso4DsvvPxaIqnd61dZRKZSJqXx01zG73JIpCRG2Dr05489+CXHC2pEXUURDSKLBNJAGPkATy/dUoxOASx44sPrVaticUsS4YYoosFkyQaiQBpUz/BRr4iT3QmAz3Jhs5FwUxLhliiigWWZj3zkt5RGbpNUyuq6FEFkyreyJQYf+H6jSTEftyURbooiAiQLKR8vSCLcFkVkyfJG/wZflY5J7UEJ+AvrPnBdElHLFpZiwQlAmQ81cS/dIUncRa6TYGy4LYnwQkSRyEXJN/o3Kn5odyG1A20pX1h3om6LicXgGVFEpt0lNa28+tavbtWODfQ5jpPGBw2Od95yCr1bX6l1W0opeEoUkWmkTKTCR/7vck/Hm6fWCE7ygwEm7Xfd+lG6C9hQk9tq2eBYDp4TRczK0jlp6W/FLW3NwRObPXmnJKkeuDNxx8ZjdkSzPkKrfLnbntYST4oiQX9YWLF3ct7SuMj5SNJW6ta3VQ6eFkVk7sFv1sy9JwaX617b3YVUBnZL2dg7YE5Z+sPVvse92nheFJHZ3SWRCr85kTCWc73F/8j1kVYjMWCoybuquVtKrfCFKBJsstemJx7D1q1e2r6VFA92b8QHHuhTrc3p6oGvRBGZqtiUpb0+ZelLGF38g4wizZr5KbY59VpVayF8J4okO7ocG1jJMrJHQdkXj6v2YxTJxreiiEx0mbT0V2Zmmlb/7JdrVVbGvAUqWnjSVVPTzMd4Ponfokg2vhZFgvYXXU0+d2msUz/cv0Fw3cVdsC6CB4vimYl4HJxX2lAqoSFEEZlFynHTeBrpWP/FXvH2mVUUps5AEDzHHY+oRpqFB4t6cfGwHBpGFAlKyaPxSKxZs+7+xfmbVc5fao+ch9y+4kxqytJ+iue4+6HkWwoNJ4qEwtSeIAgiaVhRJFKYjkj8HqZk1SE7xRqNR37cyIJIGl4UCYSZMPU9rbp536+u9Ai08Q9cW+R4HcnP8q7hdBv8Ld1DYsLUf9Sqm7sbXRBJYESRyEl/WLF3pWyl5Rfn+9STF3uZluUB6dX6GwfF7SvOplTFnkzayv5GmqQXS+BEyQY3io0lIk+1G/EtiDIQhmsxs2ANBIIgeowlIkfbjfi3vXQjVb0JtCiSdNNlMnz/jGj6UzVkLzs1tFQ5faUncNJAjlXdQ+LWnktoe/801DTzohFO/iAo6VUhKMo8IM1IvPkhTUk9HFbsnvPXFqdX/DGfabQiACblmHdAkJVdV5OWrVy2bHVvZ2RqH+WYC0UpgIw0lq3uQHp2dbLVOje8WPtkZFFaHL/NazDfgBg3dQ6LlYuuWotbJjSkVZqSOsjIURiKUgKxWGzbuGnswJPQ2vTE6glTt84Pd2tDE20CXcxeq6JBCnTt9rSOixWLrlituqmNm8bHQojDbXriYDQaPeL4RyQnFKUCII4QYtNoPLI9rNgbmjVr2aSlJ65NtRizEUcV8jaAWkkEGUSmjV1XU+mvu5onEy2aaUxZ2oWkrXzQEYkfFkIcpxjlQ1GqDDqahRB9Zkq9I5EMbwqFZvrCir3UUJMd+EkQaTxhpFLTSvpxXsUKJIVQQ/ZEm5FQIQK+TqTCo0lbuTQ93XTWCCeP62rqHSHEWT936noRilJnMiLJxxDj86bs38BMqYZlq0abnpi/ToGBL783QhHqiBDi/wHyHTKus0gmHAAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Send data to User.com application using Userengage methods.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "requiredGroup",
    "displayName": "",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "methodType",
        "displayName": "",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "event",
            "displayValue": "Send Event"
          },
          {
            "value": "productEvent",
            "displayValue": "Send Product Event"
          },
          {
            "value": "update",
            "displayValue": "Update User"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "LABEL",
        "name": "eventLabel",
        "displayName": "Send event with your custom name and desired event attributes. Remember, create event attributes with specific data types before sending them over to User.com. To learn more about events, open the article below:\n\u003cbr\u003e\nhttps://docs.user.com/what-are-events-and-how-to-create-them/",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "eventName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "clearOnCopy": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Name of your event. It does not have to be created in User.com beforehand.",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ],
        "alwaysInSummary": true
      },
      {
        "type": "LABEL",
        "name": "productEventLabel",
        "displayName": "Using this method, you can trigger a product event on a specific action. To learn more about  product events, open the article below:\n\u003cbr\u003e\nhttps://docs.user.com/how-to-create-product-events/",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "productEvent",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "productEventType",
        "displayName": "Product Event Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "view",
            "displayValue": "View"
          },
          {
            "value": "detail",
            "displayValue": "Detail"
          },
          {
            "value": "add to cart",
            "displayValue": "Add to Cart"
          },
          {
            "value": "checkout",
            "displayValue": "Checkout"
          },
          {
            "value": "checkout option",
            "displayValue": "Checkout Option"
          },
          {
            "value": "order",
            "displayValue": "Order"
          },
          {
            "value": "purchase",
            "displayValue": "Purchase"
          },
          {
            "value": "click",
            "displayValue": "Click"
          },
          {
            "value": "promo click",
            "displayValue": "Promo Click"
          },
          {
            "value": "add",
            "displayValue": "Add"
          },
          {
            "value": "remove",
            "displayValue": "Remove"
          },
          {
            "value": "add to observation",
            "displayValue": "Add to Observation"
          },
          {
            "value": "liking",
            "displayValue": "Liking"
          },
          {
            "value": "reservation",
            "displayValue": "Reservation"
          },
          {
            "value": "return",
            "displayValue": "Return"
          },
          {
            "value": "refund",
            "displayValue": "Refund"
          }
        ],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Type of an action User performed.",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "productEvent",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true,
        "alwaysInSummary": true
      },
      {
        "type": "SELECT",
        "name": "productDataType",
        "displayName": "Data Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "object",
            "displayValue": "Single Product Event"
          },
          {
            "value": "array",
            "displayValue": "Product Event from Array"
          }
        ],
        "simpleValueType": true,
        "alwaysInSummary": true,
        "clearOnCopy": true,
        "help": "",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "productEvent",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "productId",
        "displayName": "Product ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "productDataType",
            "paramValue": "object",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true,
        "valueHint": "{{ Add | DL | Product ID }}",
        "alwaysInSummary": true
      },
      {
        "type": "TEXT",
        "name": "productArray",
        "displayName": "Array of Products",
        "simpleValueType": true,
        "clearOnCopy": true,
        "enablingConditions": [
          {
            "paramName": "productDataType",
            "paramValue": "array",
            "type": "EQUALS"
          }
        ],
        "valueHint": "{{ Cart | DL | Products }}",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "updateLabel",
        "displayName": "Using this method, you can update user attributes as well. However, it won\u0027t create a pageHit. Not every attribute can be changed with this method. Please, check the attributes\u0027 list in the article below:\n\u003cbr\u003e\nhttps://docs.user.com/user-data-list-of-articles/",
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "update",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "optionalDataGroup",
    "displayName": "Attributes (optional)",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "eventAttrs",
        "displayName": "Event  Attributes",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "attribute_name"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "event",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true,
        "newRowButtonText": "Add attribute"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "productAttrs",
        "displayName": "Product Attributes",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "attribute_name"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "productDataType",
            "paramValue": "object",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [],
        "clearOnCopy": true,
        "newRowButtonText": "Add attribute"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "userAttrs",
        "displayName": "User Attributes",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "attribute_name"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "methodType",
            "paramValue": "update",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true,
        "newRowButtonText": "Add attribute"
      },
      {
        "type": "LABEL",
        "name": "attributesLabel",
        "displayName": "Pass data to update standard and custom User attributes. \u003cbr\u003e Provide standardized User attributes without blank characters, i.e. Do not use First Name, use first_name instead."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "productDataType",
        "paramValue": "array",
        "type": "NOT_EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "optionalConfigGroup",
    "displayName": "Configuration (optional)",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "namePath",
        "displayName": "Product Name path",
        "simpleValueType": true,
        "valueHint": "item_name",
        "enablingConditions": [
          {
            "paramName": "productDataType",
            "paramValue": "array",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true
      },
      {
        "type": "TEXT",
        "name": "idPath",
        "displayName": "Product ID path",
        "simpleValueType": true,
        "valueHint": "item_id",
        "enablingConditions": [
          {
            "paramName": "productDataType",
            "paramValue": "array",
            "type": "EQUALS"
          }
        ],
        "clearOnCopy": true
      },
      {
        "type": "LABEL",
        "name": "pathLabel",
        "displayName": "Provide custom path to Product Attributes if your Product Object is not following standarized property accessor naming format. I.e use it when you are using item_id instead of id."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "productDataType",
        "paramValue": "array",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "additionalConfigGroup",
    "displayName": "Additional Configuration (optional)",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "logEnabled",
        "checkboxText": "Console Logs",
        "simpleValueType": true,
        "clearOnCopy": true,
        "alwaysInSummary": true,
        "help": "Select to enable debug console logs. Selection will enable logs in both \u003cstrong\u003ePreview and Published\u003c/strong\u003e containers."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Setup Google APIs
const log = require('logToConsole');
const queryPermission = require('queryPermission');
const callInWindow = require('callInWindow');
const makeTableMap = require('makeTableMap');
const getType = require('getType');
const Object = require('Object');

const NAMESPACE = 'userengage';
const EVENT_KEYWORD = 'event.';
const PRODUCT_EVENT_KEYWORD = 'product_event';
const EVENT_TYPE_KEYWORD = 'event_type';
const UPDATE_KEYWORD = 'client.update';
const DEFAULT_NAME_PATH = 'name';
const DEFAULT_ID_PATH = 'id';
const SUCCESS_MESSAGE_EVENT = 'User.com Event |Success| Sent';
const SUCCESS_MESSAGE_PRODUCT = 'User.com Product Event |Success| Sent';
const SUCCESS_MESSAGE_USER = 'User.com Update |Success| Sent';
const FAILURE_MESSAGE_EVENT = 'User.com Event |Error| Verify name';
const FAILURE_MESSAGE_TYPE = 'User.com Product Event |Error| Verify Event Type';
const FAILURE_MESSAGE_ID = 'User.com Product Event |Error| Verify Product ID';
const FAILURE_MESSAGE_DATA = 'User.com Userengage |Error| Supplied data is not a valid Array';
const FAILURE_MESSAGE_USER = 'User.com Update |Error| Verify User Attributes';
const FAILURE_MESSAGE = 'User.com Userengage |Error| Verify inputs and required permissions';
const EMPTY_OBJECT = {};
const EMPTY_ARRAY = [];
const METHOD_MAP = {
  event: sendEvent,
  productEvent: handleProductEvent,
  update: updateUser
};


// Handle User preferences
const logger = data.logEnabled ? log : () => EMPTY_OBJECT;
const arePermissionsGranted = (name) => queryPermission('access_globals', 'execute', name);

const getEventName = (name) => EVENT_KEYWORD + name;
const getMethodType = (type) => METHOD_MAP[type];
const getEventType = (type) => ({ event_type: type });
const getProductId = (data) => ({ product_id: data });
const getData = (data) => makeTableMap(data, 'name', 'value');

// Get config values
const methodToInvoke = data.methodType ? getMethodType(data.methodType) : onFailure(FAILURE_MESSAGE);

function onSuccess (message) {
  logger(message);
  data.gtmOnSuccess();
}

function onFailure (message) {
  logger(message);
  data.gtmOnFailure();
}

function mergeObjects () {
  const resObj = EMPTY_OBJECT;
  for (const arg of arguments) {
    const keys = Object.keys(arg);
    for (const key of keys) {
      resObj[key] = arg[key];
      }
    }
  return resObj;
}

function sendEvent () {
  const eventName = data.eventName ? getEventName(data.eventName) : onFailure(FAILURE_MESSAGE_EVENT);
  const eventAttributes = data.eventAttrs ? getData(data.eventAttrs) : EMPTY_OBJECT;
  logger('Event Data:', eventAttributes);
  callInWindow(NAMESPACE, eventName, eventAttributes);
  onSuccess(SUCCESS_MESSAGE_EVENT);
}

function handleProductEvent () {
  const productDataType = data.productDataType || onFailure(FAILURE_MESSAGE_TYPE);
  const eventType = data.productEventType ? getEventType(data.productEventType) : onFailure(FAILURE_MESSAGE_TYPE); 
  
  if (productDataType === 'object') {
    const productId = data.productId ? getProductId(data.productId) : onFailure(FAILURE_MESSAGE_ID);
    const productAttributes = data.productAttrs ? getData(data.productAttrs) : EMPTY_ARRAY;
    productEventFromData(productAttributes, productId, eventType);
    
  } else if (productDataType === 'array') {
    const productArray = data.productArray || EMPTY_ARRAY;
    const productNamePath = data.namePath || DEFAULT_NAME_PATH;
    const productIdPath = data.idPath || DEFAULT_ID_PATH;    
    productEventFromArray(productArray, productNamePath, productIdPath, eventType);    
  }
}

function productEventFromData (productAttributes, productId, eventType) { 
  const mergedProductEventData = mergeObjects(productAttributes, productId, eventType);
  logger('Product Data:', mergedProductEventData);    
  sendProductEvent(mergedProductEventData);
}

function productEventFromArray (productData, namePath, idPath, type) {
  if (getType(productData) !== 'array') {
    onFailure(FAILURE_MESSAGE_DATA);
    return;
  }
  productData.forEach(function (product) {
    const attrs = EMPTY_OBJECT;
    Object.keys(product).forEach(function (attr) {
      attrs[attr] = product[attr];
      attrs.name = product[namePath];
      attrs.product_id = product[idPath];
    });
    attrs.event_type = type[EVENT_TYPE_KEYWORD];

    sendProductEvent(attrs);
  });
}

function sendProductEvent (data) {
  callInWindow(NAMESPACE, PRODUCT_EVENT_KEYWORD, data);
  onSuccess(SUCCESS_MESSAGE_PRODUCT);
}

function updateUser () {
  const userAttributes = data.userAttrs ? getData(data.userAttrs) : onFailure(FAILURE_MESSAGE_USER);
  logger('User Data:', userAttributes);
  callInWindow(NAMESPACE, UPDATE_KEYWORD, userAttributes);
  onSuccess(SUCCESS_MESSAGE_USER);
}


// Execute
if (arePermissionsGranted(NAMESPACE)) {
  methodToInvoke();
} else {
  onFailure(FAILURE_MESSAGE);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "userengage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Valid data sends Event
  code: |-
    const eventDataMock = {
      methodType: 'event',
      eventName: 'Form Submit',
      eventAttrs: [{
        name: 'Price',
        value: 100
      },
      {
        name: 'Marketing Consent',
        value: true
      },
      {
        name: 'Email',
        value: 'example@user.com'
      }]
    };

    runCode(eventDataMock);

    assertApi('callInWindow').wasCalled();
    assertApi('gtmOnSuccess').wasCalled();
- name: Valid data sends Product Event
  code: |-
    const productEventDataMock = {
      methodType: 'productEvent',
      productEventType: 'purchase',
      productId: '212',
      productDataType: 'object',
      productAttrs: [
        {
        name: 'Price',
        value: 200
        },
        {
        name: 'On Sale',
        value: true
        },
        {
        name: 'Name',
        value: 'Example Shoe'
        }]
    };

    runCode(productEventDataMock);

    assertApi('makeTableMap').wasCalled();
    assertApi('gtmOnSuccess').wasCalled();
- name: Valid array data sends Product Event
  code: |-
    const productEventDataMock = {
      methodType: 'productEvent',
      productEventType: 'order',
      productDataType: 'array',
      productArray: [
          {
            item_name: "Coffee Maker Cimbali",
            item_id: "712016",
            price: "749",
            item_brand: "Cimbali",
            item_variant: "Steel",
            item_variant_id: "388954",
            quantity: "1",
            img_url: "https://supersonicfood.com/wp-content/uploads/2021/" +
                     "06/Kakao-Male-150x150.jpg",
            url: "https://google.com"
          },
          {
            item_name: "Organic Coffee",
            item_id: "34165",
            price: "79",
            item_brand: "Amazon",
            item_variant: "Coppy",
            item_variant_id: "74451",
            quantity: "1",
            img_url: "https://supersonicfood.com/wp-content/uploads/2021/" +
                     "07/Untitled-design-51-150x150.jpg",
            url: "https://google.com"
          }
        ]
    };

    runCode(productEventDataMock);

    assertApi('makeTableMap').wasNotCalled();
    assertApi('gtmOnSuccess').wasCalled();
- name: Valid data sends Client Update
  code: |-
    const updateDataMock = {
      methodType: 'update',
      userAttrs: [
        {
        name: 'Price',
        value: 200
        },
        {
        name: 'On Sale',
        value: true
        },
        {
        name: 'Name',
        value: 'Example Shoe'
        }]
    };

    runCode(updateDataMock);

    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 6.04.2022, 10:11:12


